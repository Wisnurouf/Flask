<!-- Tombol Hapus Terpilih -->
<div class="mb-4">
  <button id="deleteSelectedBtn" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 disabled:opacity-50">
    Hapus
  </button>
</div>

<div class="bg-white rounded-xl shadow-md p-4 overflow-x-auto">
  <table class="min-w-full divide-y divide-gray-200 text-sm" id="monitorTable">
    <thead class="bg-gray-50 text-gray-700 font-semibold">
      <tr>
        <th class="px-4 py-3 text-left">
          <input type="checkbox" id="selectAll">
        </th>
        <th class="px-6 py-3 text-left">PIR 1</th>
        <th class="px-6 py-3 text-left">PIR 2</th>
        <th class="px-6 py-3 text-left">PIR 3</th>
        <th class="px-6 py-3 text-left">Jarak (cm)</th>
        <th class="px-6 py-3 text-left">Tipe Objek</th>
        <th class="px-6 py-3 text-left">Buzzer</th>
        <th class="px-6 py-3 text-left">Waktu</th>
        <th class="px-6 py-3 text-left">Pola Gerakan</th>
      </tr>
    </thead>
    <tbody id="tableBody" class="divide-y divide-gray-100 text-gray-700">
      {% for row in table_rows %}
      <tr class="hover:bg-gray-50" data-id="{{ row.id }}">
        <td class="px-4 py-3">
          <input type="checkbox" class="rowCheckbox" data-id="{{ row.id }}">
        </td>
        <td class="px-6 py-3">{{ row.pir1_status }}</td>
        <td class="px-6 py-3">{{ row.pir2_status }}</td>
        <td class="px-6 py-3">{{ row.pir3_status }}</td>
        <td class="px-6 py-3">{{ row.jarak_ultrasonik }}</td>
        <td class="px-6 py-3">{{ row.tipe_objek }}</td>
        <td class="px-6 py-3">
          {% if row.buzzer_status %}
            Aktif
          {% else %}
            Mati
          {% endif %}
        </td>
        <td class="px-6 py-3">{{ row.waktu.strftime('%Y-%m-%d %H:%M:%S') }}</td>
        <td class="px-6 py-3">{{ row.pola_gerakan or '-' }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- untuk handle centang dan hapus -->
<script>
  // Centang semua jika kotak atas dicentang
  document.getElementById("selectAll").addEventListener("change", function () {
    const checked = this.checked;
    document.querySelectorAll(".rowCheckbox").forEach(cb => {
      cb.checked = checked;
    });
  });

  // Hapus data yang dicentang
  document.getElementById("deleteSelectedBtn").addEventListener("click", function () {
    const ids = Array.from(document.querySelectorAll(".rowCheckbox:checked"))
      .map(cb => cb.getAttribute("data-id"));

    if (ids.length === 0) {
      alert("❗Pilih data yang ingin dihapus.");
      return;
    }

    if (!confirm("Apakah kamu yakin ingin menghapus data yang dipilih?")) return;

    fetch("/hapus", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({ ids })
    }).then(res => {
      if (res.ok) {
        location.reload();
      } else {
        alert("❌ Gagal menghapus data.");
      }
    });
  });
</script>
